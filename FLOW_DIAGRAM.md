# å¯è§†åŒ–æµç¨‹å›¾

## ğŸ¨ å®Œæ•´ç™»å½•æ³¨å†Œæµç¨‹ï¼ˆå‚è€ƒ IDChatï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·è®¿é—®é¡µé¢                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              é¡µé¢åˆå§‹åŒ–ï¼ˆApp.vue onMountedï¼‰                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. userStore.init()                               â”‚    â”‚
â”‚  â”‚     â””â”€â†’ ä» localStorage åŠ è½½ç”¨æˆ·ä¿¡æ¯               â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  2. walletStore.init()                             â”‚    â”‚
â”‚  â”‚     â”œâ”€â†’ å¼‚æ­¥æ£€æµ‹ Metaletï¼ˆ300ms Ã— 50 = 15ç§’ï¼‰      â”‚    â”‚
â”‚  â”‚     â”œâ”€â†’ æ£€æµ‹åˆ° â†’ å°è¯•è·å–å½“å‰åœ°å€                  â”‚    â”‚
â”‚  â”‚     â””â”€â†’ åœ°å€åŒ¹é… â†’ æ¢å¤ç™»å½•çŠ¶æ€                    â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  3. walletStore.setupEventListeners()             â”‚    â”‚
â”‚  â”‚     â”œâ”€â†’ ç›‘å¬è´¦æˆ·åˆ‡æ¢                               â”‚    â”‚
â”‚  â”‚     â””â”€â†’ ç›‘å¬ç½‘ç»œåˆ‡æ¢                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 é¡µé¢æ¸²æŸ“å®Œæˆ                                 â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ æœªæ£€æµ‹åˆ°é’±åŒ…  â”‚     â”‚ æ£€æµ‹åˆ°é’±åŒ…    â”‚                     â”‚
â”‚  â”‚ (15ç§’è¶…æ—¶)   â”‚     â”‚ (æˆåŠŸæ£€æµ‹)    â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                    â”‚                              â”‚
â”‚         â–¼                    â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ æ˜¾ç¤º         â”‚     â”‚ localStorage â”‚                     â”‚
â”‚  â”‚ "å®‰è£…Metalet"â”‚     â”‚ æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Ÿ  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                              â”‚                              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚         â”‚                    â”‚                    â”‚        â”‚
â”‚         â–¼                    â–¼                    â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   æ˜¯ ä¸”       â”‚     â”‚   æ˜¯ ä½†       â”‚     â”‚     å¦       â”‚â”‚
â”‚  â”‚  åœ°å€åŒ¹é…     â”‚     â”‚  åœ°å€ä¸åŒ¹é…    â”‚     â”‚  (æ–°è®¿é—®)   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚         â”‚                    â”‚                    â”‚        â”‚
â”‚         â–¼                    â–¼                    â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âœ… è‡ªåŠ¨æ¢å¤   â”‚     â”‚ âš ï¸ æ¸…ç©ºæ—§     â”‚     â”‚   æ˜¾ç¤º       â”‚â”‚
â”‚  â”‚   ç™»å½•çŠ¶æ€    â”‚     â”‚   ç”¨æˆ·ä¿¡æ¯    â”‚     â”‚"Connect      â”‚â”‚
â”‚  â”‚              â”‚     â”‚ æ˜¾ç¤ºè¿æ¥æŒ‰é’®   â”‚     â”‚  Wallet"    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                    â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ ç”¨æˆ·ç‚¹å‡» "Connect Wallet"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ConnectWalletModal å¼¹çª—                      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  æ­¥éª¤ 1: é€‰æ‹©é’±åŒ…                                   â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚    â”‚
â”‚  â”‚  â–¡ å‹¾é€‰ã€Šç”¨æˆ·åè®®ã€‹å’Œã€Šéšç§æ”¿ç­–ã€‹                  â”‚    â”‚
â”‚  â”‚  [Metalet é’±åŒ…] æŒ‰é’®                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â”‚                                     â”‚
â”‚                       â”‚ ç”¨æˆ·å‹¾é€‰åè®®å¹¶ç‚¹å‡»                   â”‚
â”‚                       â”‚                                     â”‚
â”‚                       â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  æ­¥éª¤ 2: æ£€æµ‹é’±åŒ…ï¼ˆdetectingï¼‰                     â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚    â”‚
â”‚  â”‚  ğŸ”„ "æ­£åœ¨æ£€æµ‹ Metalet é’±åŒ…..."                     â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  services/walletConnect.ts:                        â”‚    â”‚
â”‚  â”‚  â”œâ”€â†’ walletStore.waitForMetalet(20, 300)          â”‚    â”‚
â”‚  â”‚  â””â”€â†’ æ¯ 300ms æ£€æŸ¥ä¸€æ¬¡ï¼Œæœ€å¤š 20 æ¬¡ = 6ç§’          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â”‚                                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚         â”‚                           â”‚                      â”‚
â”‚         â–¼                           â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ æœªæ£€æµ‹åˆ°      â”‚           â”‚  æ£€æµ‹æˆåŠŸ     â”‚              â”‚
â”‚  â”‚ (6ç§’è¶…æ—¶)    â”‚           â”‚              â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                          â”‚                       â”‚
â”‚         â–¼                          â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ é”™è¯¯æç¤º:     â”‚           â”‚  æ­¥éª¤ 3: è¿æ¥é’±åŒ…         â”‚  â”‚
â”‚  â”‚ "æœªæ£€æµ‹åˆ°é’±åŒ…"â”‚           â”‚  (connecting)            â”‚  â”‚
â”‚  â”‚              â”‚           â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚  â”‚
â”‚  â”‚ æ‰“å¼€å®‰è£…é“¾æ¥  â”‚           â”‚  ğŸ”— "è¯·åœ¨Metaletä¸­ç¡®è®¤"  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                          â”‚  â”‚
â”‚                             â”‚  walletStore.connect()    â”‚  â”‚
â”‚                             â”‚  â””â”€â†’ metaidwallet.connect()â”‚  â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                       â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                      â”‚                           â”‚        â”‚
â”‚                      â–¼                           â–¼        â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚               â”‚ ç”¨æˆ·æ‹’ç»      â”‚           â”‚  è¿æ¥æˆåŠŸ     â”‚ â”‚
â”‚               â”‚ (å–æ¶ˆè¿æ¥)    â”‚           â”‚              â”‚ â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                      â”‚                          â”‚         â”‚
â”‚                      â–¼                          â–¼         â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚               â”‚ é”™è¯¯æç¤º:     â”‚           â”‚  æ­¥éª¤ 4: æ£€æŸ¥ç”¨æˆ·ç±»å‹     â”‚â”‚
â”‚               â”‚ "è¿æ¥è¢«æ‹’ç»"  â”‚           â”‚  (checking)              â”‚â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚â”‚
â”‚                                          â”‚  ğŸ” "æ­£åœ¨æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯"   â”‚â”‚
â”‚                                          â”‚                          â”‚â”‚
â”‚                                          â”‚  api.checkUserExists()    â”‚â”‚
â”‚                                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                 â”‚                     â”‚
â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚                                   â”‚                           â”‚      â”‚
â”‚                                   â–¼                           â–¼      â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            â”‚   æ–°ç”¨æˆ·      â”‚           â”‚   è€ç”¨æˆ·      â”‚
â”‚                            â”‚  (isNew=true) â”‚           â”‚ (isNew=false)â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                   â”‚                          â”‚       â”‚
â”‚                                   â–¼                          â–¼       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  æ­¥éª¤ 5A: æ³¨å†Œæµç¨‹ (registering)        â”‚  â”‚  æ­¥éª¤ 5B: ç™»å½•æµç¨‹ (logging-in)    â”‚â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚â”‚
â”‚  â”‚  ğŸ“ "æ­£åœ¨ä¸ºæ‚¨åˆ›å»ºè´¦æˆ·..."              â”‚  â”‚  ğŸ” "æ­£åœ¨ç™»å½•..."                  â”‚â”‚
â”‚  â”‚                                         â”‚  â”‚                                    â”‚â”‚
â”‚  â”‚  api.registerUser(account, profile)    â”‚  â”‚  api.loginUser(account, signature) â”‚â”‚
â”‚  â”‚  â”œâ”€â†’ åˆ›å»º UserInfo                     â”‚  â”‚  â”œâ”€â†’ éªŒè¯ç­¾åï¼ˆå¯é€‰ï¼‰              â”‚â”‚
â”‚  â”‚  â”œâ”€â†’ ç”Ÿæˆ Access Token                 â”‚  â”‚  â”œâ”€â†’ è·å– UserInfo                 â”‚â”‚
â”‚  â”‚  â””â”€â†’ è¿”å› { user, token }              â”‚  â”‚  â””â”€â†’ è¿”å› { user, token }          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                       â”‚                                        â”‚                    â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                        â”‚                                            â”‚
â”‚                                        â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ­¥éª¤ 6: ä¿å­˜ç”¨æˆ·ä¿¡æ¯                                                       â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚   â”‚
â”‚  â”‚  userStore.userInfo = result.data.user                                     â”‚   â”‚
â”‚  â”‚  userStore.accessToken = result.data.token                                 â”‚   â”‚
â”‚  â”‚  userStore.saveToStorage()                                                 â”‚   â”‚
â”‚  â”‚      â”‚                                                                      â”‚   â”‚
â”‚  â”‚      â”œâ”€â†’ localStorage.setItem('metaid_user_info', JSON.stringify(user))   â”‚   â”‚
â”‚  â”‚      â”œâ”€â†’ localStorage.setItem('metaid_access_token', token)               â”‚   â”‚
â”‚  â”‚      â””â”€â†’ localStorage.setItem('metaid_wallet_address', address)           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚                                                            â”‚
â”‚                       â–¼                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  æ­¥éª¤ 7: æˆåŠŸ (success)                                                     â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚   â”‚
â”‚  â”‚  âœ… "ç™»å½•æˆåŠŸï¼"                                                            â”‚   â”‚
â”‚  â”‚                                                                             â”‚   â”‚
â”‚  â”‚  callbacks.onSuccess(account, isNewUser)                                   â”‚   â”‚
â”‚  â”‚  â”œâ”€â†’ UI æ˜¾ç¤ºæˆåŠŸå›¾æ ‡                                                        â”‚   â”‚
â”‚  â”‚  â”œâ”€â†’ æ˜¾ç¤ºç”¨æˆ·åœ°å€                                                           â”‚   â”‚
â”‚  â”‚  â””â”€â†’ 1.5ç§’åè‡ªåŠ¨å…³é—­å¼¹çª—                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  è¿”å›ä¸»é¡µé¢                                  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  UI è‡ªåŠ¨æ›´æ–°ï¼š                                      â”‚    â”‚
â”‚  â”‚  â”œâ”€â†’ å³ä¸Šè§’æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å¡ç‰‡                         â”‚    â”‚
â”‚  â”‚  â”œâ”€â†’ ç™»å½•çŠ¶æ€å¡ç‰‡æ˜¾ç¤º"âœ… å·²ç™»å½•"                    â”‚    â”‚
â”‚  â”‚  â”œâ”€â†’ ç”¨æˆ·ä¿¡æ¯å¡ç‰‡æ˜¾ç¤ºå¤´åƒã€åç§°ã€åœ°å€               â”‚    â”‚
â”‚  â”‚  â””â”€â†’ ä¸‹æ‹‰èœå•å¯æ–­å¼€è¿æ¥                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ è´¦æˆ·åˆ‡æ¢æµç¨‹

```
ç”¨æˆ·åœ¨ Metalet ä¸­åˆ‡æ¢è´¦æˆ·
    â†“
è§¦å‘ accountsChanged äº‹ä»¶
    â†“
walletStore.setupEventListeners() ä¸­çš„ç›‘å¬å™¨
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ£€æµ‹åˆ°æ–°è´¦æˆ·                        â”‚
â”‚  newAccount.address !== æ—§åœ°å€      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¸…ç©ºæ—§ç”¨æˆ·ä¿¡æ¯                      â”‚
â”‚  userStore.logout()                 â”‚
â”‚  â”œâ”€â†’ userInfo = null                â”‚
â”‚  â”œâ”€â†’ accessToken = null             â”‚
â”‚  â””â”€â†’ æ¸…ç©º localStorage               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI æ›´æ–°                             â”‚
â”‚  â”œâ”€â†’ æ˜¾ç¤º "Connect Wallet" æŒ‰é’®     â”‚
â”‚  â””â”€â†’ æç¤ºç”¨æˆ·é‡æ–°ç™»å½•                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸšª é€€å‡ºç™»å½•æµç¨‹

```
ç”¨æˆ·ç‚¹å‡» "æ–­å¼€è¿æ¥"
    â†“
walletStore.disconnect()
    â”‚
    â”œâ”€â†’ è°ƒç”¨ metaidwallet.disconnect()
    â”‚
    â””â”€â†’ è°ƒç”¨ userStore.logout()
        â”‚
        â”œâ”€â†’ æ¸…ç©ºçŠ¶æ€
        â”‚   â”œâ”€ userInfo = null
        â”‚   â”œâ”€ accessToken = null
        â”‚   â””â”€ loginError = null
        â”‚
        â””â”€â†’ æ¸…ç©º localStorage
            â”œâ”€ removeItem('metaid_user_info')
            â”œâ”€ removeItem('metaid_access_token')
            â””â”€ removeItem('metaid_wallet_address')
    â†“
UI è‡ªåŠ¨æ›´æ–°
    â”œâ”€â†’ å³ä¸Šè§’æ˜¾ç¤º "Connect Wallet" æŒ‰é’®
    â”œâ”€â†’ ç™»å½•çŠ¶æ€å¡ç‰‡æ˜¾ç¤º "âŒ æœªç™»å½•"
    â””â”€â†’ ç”¨æˆ·ä¿¡æ¯å¡ç‰‡éšè—
```

## ğŸ“¦ æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æµè§ˆå™¨å±‚                                     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   Metalet    â”‚          â”‚  localStorageâ”‚                â”‚
â”‚  â”‚   Extension  â”‚          â”‚              â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â”‚                         â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                         â”‚
          â”‚ window.metaidwallet     â”‚ get/set/remove
          â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â”‚         åº”ç”¨å±‚           â”‚                         â”‚
â”‚         â”‚                         â”‚                         â”‚
â”‚         â–¼                         â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Wallet      â”‚          â”‚    User      â”‚                â”‚
â”‚  â”‚  Store       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    Store     â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â”‚                         â”‚                         â”‚
â”‚         â”‚  ä½¿ç”¨                    â”‚  ä½¿ç”¨                   â”‚
â”‚         â”‚                         â”‚                         â”‚
â”‚         â–¼                         â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   walletConnect Service              â”‚                  â”‚
â”‚  â”‚   (æ ¸å¿ƒä¸šåŠ¡é€»è¾‘)                     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                                                   â”‚
â”‚         â”‚  è°ƒç”¨                                             â”‚
â”‚         â”‚                                                   â”‚
â”‚         â–¼                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚      User API Layer                  â”‚                  â”‚
â”‚  â”‚  â”œâ”€ checkUserExists()                â”‚                  â”‚
â”‚  â”‚  â”œâ”€ loginUser()                      â”‚                  â”‚
â”‚  â”‚  â””â”€ registerUser()                   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ HTTP Request
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åç«¯æœåŠ¡å™¨                                   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  ç”¨æˆ·æ•°æ®åº“   â”‚          â”‚  Token æœåŠ¡   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ ¸å¿ƒæ–¹æ³•è°ƒç”¨é“¾

### connectMetalet() è°ƒç”¨é“¾

```
ConnectWalletModal.vue
    â”‚
    â”‚ const result = await connectMetalet({ callbacks })
    â”‚
    â–¼
services/walletConnect.ts :: connectMetalet()
    â”‚
    â”œâ”€â”€â†’ [1] walletStore.waitForMetalet(20, 300)
    â”‚       â””â”€â†’ æ¯ 300ms æ£€æŸ¥ window.metaidwallet
    â”‚           â””â”€â†’ è¿”å› boolean
    â”‚
    â”œâ”€â”€â†’ [2] walletStore.connect()
    â”‚       â””â”€â†’ window.metaidwallet.connect()
    â”‚           â””â”€â†’ è¿”å› MetaletAccount
    â”‚
    â”œâ”€â”€â†’ [3] api.checkUserExists(address)
    â”‚       â””â”€â†’ fetch('/api/users/check?address=...')
    â”‚           â””â”€â†’ è¿”å› { exists, isNewUser }
    â”‚
    â”œâ”€â”€â†’ [4A] api.registerUser(account, profile)  (æ–°ç”¨æˆ·)
    â”‚       â””â”€â†’ fetch('/api/users/register', ...)
    â”‚           â””â”€â†’ è¿”å› { user, token }
    â”‚
    â”œâ”€â”€â†’ [4B] api.loginUser(account, signature)   (è€ç”¨æˆ·)
    â”‚       â””â”€â†’ fetch('/api/users/login', ...)
    â”‚           â””â”€â†’ è¿”å› { user, token }
    â”‚
    â””â”€â”€â†’ [5] userStore.saveToStorage()
            â””â”€â†’ utils/storage.setStorage()
                â”œâ”€â†’ localStorage.setItem('metaid_user_info', ...)
                â”œâ”€â†’ localStorage.setItem('metaid_access_token', ...)
                â””â”€â†’ localStorage.setItem('metaid_wallet_address', ...)
    â”‚
    â””â”€â”€â†’ callbacks.onSuccess(account, isNewUser)
```

## ğŸ” çŠ¶æ€å˜åŒ–æ—¶åºå›¾

```
æ—¶é—´è½´                          loginStep çŠ¶æ€              UI æ˜¾ç¤º
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0ms      ç”¨æˆ·ç‚¹å‡»è¿æ¥           'select'               é’±åŒ…é€‰æ‹©ç•Œé¢
                                                        
100ms    ç‚¹å‡» Metalet           'detecting'            ğŸ”„ æ£€æµ‹åŠ¨ç”»
                                                       "æ­£åœ¨æ£€æµ‹é’±åŒ…..."
                                                        
2000ms   æ£€æµ‹æˆåŠŸ               'connecting'           ğŸ”— è¿æ¥åŠ¨ç”»
                                                       "è¯·åœ¨Metaletä¸­ç¡®è®¤"
                                                        
5000ms   ç”¨æˆ·ç¡®è®¤è¿æ¥           'checking'             ğŸ” åŠ è½½åŠ¨ç”»
                                                       "æ­£åœ¨æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯..."
                                                        
6000ms   æ£€æŸ¥å®Œæˆ(æ–°ç”¨æˆ·)       'registering'          ğŸ“ åŠ è½½åŠ¨ç”»
                                                       "æ­£åœ¨åˆ›å»ºè´¦æˆ·..."
                                                        
æˆ–       æ£€æŸ¥å®Œæˆ(è€ç”¨æˆ·)       'logging-in'           ğŸ” åŠ è½½åŠ¨ç”»
                                                       "æ­£åœ¨ç™»å½•..."
                                                        
7000ms   æ³¨å†Œ/ç™»å½•æˆåŠŸ          'success'              âœ… æˆåŠŸå›¾æ ‡
                                                       "ç™»å½•æˆåŠŸï¼"
                                                       æ˜¾ç¤ºåœ°å€
                                                        
8500ms   è‡ªåŠ¨å…³é—­å¼¹çª—           (å…³é—­)                 è¿”å›ä¸»é¡µé¢
                                                       æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
```

## ğŸ’¾ LocalStorage å˜åŒ–å›¾

```
åˆå§‹çŠ¶æ€ï¼ˆæœªç™»å½•ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  localStorage            â”‚
â”‚  (ç©º)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â”‚
            â”‚ ç™»å½•æˆåŠŸ
            â–¼

ç™»å½•å
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  localStorage                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ metaid_user_info: {                            â”‚ â”‚
â”‚  â”‚   address: "1ABC...",                          â”‚ â”‚
â”‚  â”‚   mvcAddress: "xxx...",                        â”‚ â”‚
â”‚  â”‚   btcAddress: "bc1...",                        â”‚ â”‚
â”‚  â”‚   name: "ç”¨æˆ·1ABC",                            â”‚ â”‚
â”‚  â”‚   loginTime: 1696934400000,                    â”‚ â”‚
â”‚  â”‚   lastActiveTime: 1696934400000                â”‚ â”‚
â”‚  â”‚ }                                              â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ metaid_access_token: "token_1ABC..._16969..."  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ metaid_wallet_address: "1ABC..."               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â”‚
            â”‚ é€€å‡ºç™»å½•
            â–¼

é€€å‡ºå
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  localStorage            â”‚
â”‚  (å·²æ¸…ç©º)                â”‚
â”‚  âŒ metaid_user_info      â”‚
â”‚  âŒ metaid_access_token   â”‚
â”‚  âŒ metaid_wallet_address â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ åˆ·æ–°é¡µé¢æ¢å¤æµç¨‹

```
é¡µé¢åˆ·æ–°
    â†“
App.vue: onMounted()
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. userStore.init()                        â”‚
â”‚     â””â”€â†’ loadFromStorage()                   â”‚
â”‚         â””â”€â†’ localStorage.getItem(...)       â”‚
â”‚             â”œâ”€â†’ æ‰¾åˆ°æ•°æ® â†’ æ¢å¤çŠ¶æ€          â”‚
â”‚             â””â”€â†’ æœªæ‰¾åˆ° â†’ ä¿æŒæœªç™»å½•          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. walletStore.init()                      â”‚
â”‚     â”œâ”€â†’ waitForMetalet() (15ç§’)            â”‚
â”‚     â”œâ”€â†’ getAddress() è·å–å½“å‰é’±åŒ…åœ°å€       â”‚
â”‚     â””â”€â†’ éªŒè¯åœ°å€                            â”‚
â”‚         â”œâ”€â†’ åŒ¹é… â†’ updateLastActiveTime()   â”‚
â”‚         â””â”€â†’ ä¸åŒ¹é… â†’ userStore.logout()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. walletStore.setupEventListeners()      â”‚
â”‚     â”œâ”€â†’ on('accountsChanged')              â”‚
â”‚     â””â”€â†’ on('networkChanged')               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡µé¢æ¸²æŸ“å®Œæˆ                                â”‚
â”‚  â”œâ”€â†’ ç™»å½•çŠ¶æ€å·²æ¢å¤ï¼ˆå¦‚æœåœ°å€åŒ¹é…ï¼‰          â”‚
â”‚  â””â”€â†’ æˆ–æ˜¾ç¤º"Connect Wallet"ï¼ˆå¦‚æœæœªç™»å½•ï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“š æ¨¡å—ä¾èµ–å›¾

```
ConnectWalletModal.vue
    â”‚
    â”œâ”€â†’ connectMetalet() from '@/services/walletConnect'
    â”œâ”€â†’ useWalletStore() from '@/stores/wallet'
    â””â”€â†’ useUserStore() from '@/stores/user'

services/walletConnect.ts
    â”‚
    â”œâ”€â†’ useWalletStore()
    â”‚   â”œâ”€â†’ waitForMetalet()
    â”‚   â””â”€â†’ connect()
    â”‚
    â”œâ”€â†’ useUserStore()
    â”‚   â””â”€â†’ saveToStorage()
    â”‚       â””â”€â†’ utils/storage.setStorage()
    â”‚
    â””â”€â†’ api/user
        â”œâ”€â†’ checkUserExists()
        â”œâ”€â†’ loginUser()
        â””â”€â†’ registerUser()
            â””â”€â†’ fetch() (æµè§ˆå™¨ API)

stores/wallet.ts
    â”‚
    â””â”€â†’ window.metaidwallet (Metalet Wallet API)

stores/user.ts
    â”‚
    â””â”€â†’ utils/storage
        â”œâ”€â†’ getStorage()
        â”œâ”€â†’ setStorage()
        â””â”€â†’ clearStorage()
```

## ğŸ¨ UI çŠ¶æ€æœº

```
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  select  â”‚ â—„â”€â”€â”€ åˆå§‹çŠ¶æ€
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
               â”‚ ç‚¹å‡»è¿æ¥
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚detecting â”‚ â—„â”€â”€â”€ æ£€æµ‹é’±åŒ…
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
               â”‚ æ£€æµ‹æˆåŠŸ
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚connectingâ”‚ â—„â”€â”€â”€ è¿æ¥é’±åŒ…
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
               â”‚ è¿æ¥æˆåŠŸ
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ checking â”‚ â—„â”€â”€â”€ æ£€æŸ¥ç”¨æˆ·
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                 â”‚
      â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚registering â”‚    â”‚ logging-in â”‚
â”‚  (æ–°ç”¨æˆ·)  â”‚    â”‚  (è€ç”¨æˆ·)  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                 â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ æˆåŠŸ
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ success  â”‚ â—„â”€â”€â”€ æˆåŠŸçŠ¶æ€
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
               â”‚ 1.5ç§’å
               â–¼
           (å…³é—­å¼¹çª—)
               â”‚
               â–¼
           (ç»“æŸ)
```

## ğŸ” å®‰å…¨æµç¨‹å›¾

```
ç”¨æˆ·è¿æ¥é’±åŒ…
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ç”¨æˆ·åè®®ä¿æŠ¤                     â”‚
â”‚     if (!isAgreementAccepted) {     â”‚
â”‚       return 'è¯·å…ˆåŒæ„åè®®'          â”‚
â”‚     }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. é’±åŒ…è¿æ¥ï¼ˆç”¨æˆ·å¿…é¡»ç¡®è®¤ï¼‰          â”‚
â”‚     window.metaidwallet.connect()   â”‚
â”‚     â””â”€â†’ ç”¨æˆ·åœ¨ Metalet ä¸­ç¡®è®¤        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. å¯é€‰ï¼šç­¾åéªŒè¯                   â”‚
â”‚     signLoginMessage(address)       â”‚
â”‚     â””â”€â†’ è¯æ˜åœ°å€æ‰€æœ‰æƒ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. æœåŠ¡å™¨éªŒè¯ï¼ˆTODOï¼‰               â”‚
â”‚     api.loginUser(account, signature)â”‚
â”‚     â””â”€â†’ åç«¯éªŒè¯ç­¾å                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. è¿”å› Token                       â”‚
â”‚     { user, token }                 â”‚
â”‚     â””â”€â†’ ä¿å­˜åˆ° localStorage          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. å®šæœŸæ£€æŸ¥ Token æœ‰æ•ˆæ€§            â”‚
â”‚     checkLoginStatus()              â”‚
â”‚     â””â”€â†’ 7å¤©æœªæ´»è·ƒè‡ªåŠ¨é€€å‡º            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ å…³é”®ä»£ç ç‰‡æ®µ

### 1. æ ¸å¿ƒè¿æ¥æ–¹æ³•

```typescript
// services/walletConnect.ts
export async function connectMetalet(callbacks) {
  // æ­¥éª¤ 1: æ£€æµ‹
  callbacks?.onStepChange?.('detecting')
  const isAvailable = await walletStore.waitForMetalet(20, 300)
  
  // æ­¥éª¤ 2: è¿æ¥
  callbacks?.onStepChange?.('connecting')
  await walletStore.connect()
  
  // æ­¥éª¤ 3: æ£€æŸ¥
  callbacks?.onStepChange?.('checking')
  const { isNewUser } = await checkUserExists(address)
  
  // æ­¥éª¤ 4: æ³¨å†Œ/ç™»å½•
  if (isNewUser) {
    callbacks?.onStepChange?.('registering')
    await registerUser(account)
  } else {
    callbacks?.onStepChange?.('logging-in')
    await loginUser(account)
  }
  
  // æ­¥éª¤ 5: å®Œæˆ
  userStore.saveToStorage()
  callbacks?.onSuccess?.(account, isNewUser)
  
  return { success: true, isNewUser }
}
```

### 2. ç»„ä»¶ä½¿ç”¨

```vue
<!-- ConnectWalletModal.vue -->
<script setup>
const connectMetalet = async () => {
  const result = await connectMetaletService({
    onStepChange: (step) => loginStep.value = step,
    onProgress: (msg) => progressMessage.value = msg,
    onError: (err) => errorMessage.value = err,
    onSuccess: (account, isNew) => {
      emit('success', isNew)
      setTimeout(closeModal, 1500)
    },
  })
}
</script>
```

---

**å®Œæ•´çš„ä¼ä¸šçº§ Web3 ç™»å½•æ³¨å†Œç³»ç»Ÿ v2.0 å·²å°±ç»ªï¼** ğŸ‰

**ç«‹å³å¼€å§‹ï¼š** `./dev.sh` â†’ è®¿é—® http://localhost:5174 â†’ ç‚¹å‡» "Connect Wallet" ğŸš€

