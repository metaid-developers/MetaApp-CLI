# Metalet 钱包功能测试指南

## 🎯 测试前准备

### 第 1 步：安装 Metalet 钱包

**Chrome/Edge 用户：**
1. 访问：https://chromewebstore.google.com/detail/metalet/lbjapbcmmceacocpimbpbidpgmlmoaao
2. 点击 "添加到 Chrome"
3. 安装完成后，浏览器右上角会出现 Metalet 图标

**首次使用：**
1. 点击 Metalet 图标
2. 选择 "创建新钱包" 或 "导入钱包"
3. 设置密码
4. **重要：备份助记词！**
5. 完成设置

### 第 2 步：启动项目

```bash
# 确保使用正确的 Node.js 版本
nvm use 20.19.1

# 启动开发服务器
./dev.sh
```

应该看到：
```
✓ Node.js: v20.19.1
✓ npm: 10.8.2

VITE v7.1.9  ready in 467 ms
➜  Local:   http://localhost:5173/
```

### 第 3 步：打开应用

浏览器访问：`http://localhost:5173`

## ✅ 功能测试清单

### 测试 1：检测 Metalet 钱包

**预期结果：**
- ✅ 如果已安装：显示 "Connect Wallet" 按钮
- ✅ 如果未安装：显示 "安装 Metalet" 按钮和黄色提示框

**测试步骤：**
1. 打开应用
2. 查看右上角按钮

**故障排除：**
- 如果显示 "安装 Metalet" 但您已安装
  - 刷新页面（Cmd/Ctrl + R）
  - 确认 Metalet 扩展已启用

---

### 测试 2：连接钱包

**测试步骤：**
1. 点击右上角 **"Connect Wallet"** 按钮
2. Metalet 弹窗出现
3. 在弹窗中点击 **"连接"** 或 **"授权"**
4. 页面自动更新

**预期结果：**
- ✅ 按钮变成钱包信息卡片
- ✅ 显示网络指示器（绿点 = 主网）
- ✅ 显示 BTC 余额
- ✅ 显示短地址（如 `1ABC...xyz`）
- ✅ 页面卡片显示 "✅ 已连接"

**检查点：**
```
右上角显示：
┌────────────────────────────┐
│ 🟢 0.00001234 BTC 1AB...xy ▼│
└────────────────────────────┘
```

**故障排除：**
- 如果没有弹窗
  - 检查浏览器是否阻止了弹窗
  - 点击地址栏的弹窗图标
- 如果连接失败
  - 确认 Metalet 已解锁
  - 刷新页面重试

---

### 测试 3：查看余额详情

**测试步骤：**
1. 点击右上角的钱包信息卡片
2. 下拉菜单展开

**预期结果：**
```
┌─────────────────────────────┐
│ 我的地址                     │
│ 1ABCxxxxxxxxxxxxxxxxxxy123  │ ← 可点击复制
├─────────────────────────────┤
│ 已确认: 0.00001234 BTC      │
│ 未确认: 0.00000000 BTC      │
│ 总计:   0.00001234 BTC      │
├─────────────────────────────┤
│ 🔄 刷新余额                  │
│ 📋 复制地址                  │
├─────────────────────────────┤
│ 🔌 断开连接                  │
└─────────────────────────────┘
```

**检查点：**
- ✅ 地址完整显示
- ✅ 余额正确（与 Metalet 钱包中一致）
- ✅ 已确认 + 未确认 = 总计

---

### 测试 4：复制地址

**测试步骤：**
1. 打开下拉菜单
2. 点击 "复制地址"

**预期结果：**
- ✅ 弹出提示 "地址已复制到剪贴板"
- ✅ 粘贴到文本编辑器，地址正确

**验证：**
```bash
# 打开终端或任意文本编辑器
# Cmd/Ctrl + V 粘贴
# 应该看到完整的钱包地址
```

---

### 测试 5：刷新余额

**测试步骤：**
1. 打开下拉菜单
2. 点击 "刷新余额"
3. 等待 1-2 秒

**预期结果：**
- ✅ 余额数据更新
- ✅ 无报错

**测试场景：**
- 在其他地方接收转账后
- 点击刷新可以看到最新余额

---

### 测试 6：断开连接

**测试步骤：**
1. 打开下拉菜单
2. 点击 "断开连接"

**预期结果：**
- ✅ 按钮变回 "Connect Wallet"
- ✅ 页面卡片显示 "❌ 未连接"
- ✅ 余额信息清空

---

### 测试 7：账户切换监听

**测试步骤：**
1. 保持应用打开并已连接
2. 点击 Metalet 图标
3. 在 Metalet 中切换到另一个账户

**预期结果：**
- ✅ 页面自动更新
- ✅ 显示新账户的地址
- ✅ 显示新账户的余额
- ✅ Console 输出：`账户已切换: {...}`

---

### 测试 8：网络切换监听

**测试步骤：**
1. 保持应用打开并已连接
2. 在 Metalet 中切换网络（主网 ↔ 测试网）

**预期结果：**
- ✅ 网络指示器颜色改变
  - 🟢 绿色 = 主网
  - 🟠 橙色 = 测试网
- ✅ 网络卡片更新显示
- ✅ Console 输出：`网络已切换: testnet`

---

### 测试 9：响应式布局

**测试步骤：**
1. 调整浏览器窗口大小
2. 测试移动端视图（F12 → 切换设备工具栏）

**预期结果：**
- ✅ 桌面端：卡片3列布局
- ✅ 平板端：卡片2列布局
- ✅ 移动端：卡片1列布局
- ✅ 钱包按钮在各尺寸下都可见

---

### 测试 10：错误处理

**测试场景 A：钱包未解锁**
1. 锁定 Metalet 钱包
2. 点击 "Connect Wallet"

**预期结果：**
- ✅ Metalet 要求输入密码
- ✅ 解锁后正常连接

**测试场景 B：用户拒绝连接**
1. 点击 "Connect Wallet"
2. 在 Metalet 弹窗中点击 "拒绝"

**预期结果：**
- ✅ 显示错误提示（红色toast）
- ✅ 按钮仍为 "Connect Wallet"
- ✅ 可以重新尝试连接

---

## 🎨 UI/UX 测试

### 视觉测试

**检查点：**
- ✅ 颜色主题统一
- ✅ 深色模式切换正常
- ✅ 图标清晰可见
- ✅ 文字大小合适
- ✅ 间距布局美观

### 交互测试

**检查点：**
- ✅ 按钮有 hover 效果
- ✅ 下拉菜单动画流畅
- ✅ 加载状态显示（连接中...）
- ✅ 网络指示器颜色正确
- ✅ 复制地址有反馈

### 可访问性测试

**检查点：**
- ✅ 可以用 Tab 键导航
- ✅ 按钮有焦点样式
- ✅ 错误提示清晰
- ✅ 屏幕阅读器友好

---

## 🐛 常见问题测试

### 问题 1：页面提示 "未检测到 Metalet 钱包"

**调试步骤：**
1. 打开浏览器控制台（F12）
2. 输入：`console.log(window.metaidwallet)`
3. 如果显示 `undefined`：
   - 确认 Metalet 已安装
   - 刷新页面
   - 检查扩展是否启用

### 问题 2：连接后余额为 0

**调试步骤：**
1. 打开控制台
2. 输入：`console.log(walletStore.balance)`
3. 检查返回值
4. 在 Metalet 钱包中确认余额
5. 点击 "刷新余额"

### 问题 3：切换账户后页面没更新

**调试步骤：**
1. 打开控制台
2. 查看是否有 "账户已切换" 日志
3. 如果没有：
   - 刷新页面
   - 重新连接钱包

---

## 📊 性能测试

### 加载速度

**测试：**
1. 清除浏览器缓存
2. 重新访问页面
3. 查看 Network 面板

**目标：**
- ✅ 首次加载 < 2秒
- ✅ 后续加载 < 500ms
- ✅ Vite HMR < 100ms

### 钱包连接速度

**测试：**
1. 点击 "Connect Wallet"
2. 在 Metalet 中点击 "连接"
3. 计时到页面更新

**目标：**
- ✅ 连接响应 < 1秒
- ✅ 余额加载 < 2秒

---

## 🎓 进阶测试

### 控制台调试

```javascript
// 打开控制台（F12 → Console）

// 1. 查看钱包对象
window.metaidwallet

// 2. 查看 store 状态
import { useWalletStore } from './stores/wallet'
const store = useWalletStore()
console.log(store.$state)

// 3. 手动调用 API
await window.metaidwallet.getBalance()

// 4. 测试签名
await window.metaidwallet.signMessage('Test Message')
```

### 网络调试

```javascript
// 切换到测试网
await window.metaidwallet.switchNetwork('testnet')

// 切换回主网
await window.metaidwallet.switchNetwork('mainnet')
```

---

## ✅ 完整测试报告模板

```markdown
## 测试日期：2025-10-10

### 环境
- 浏览器：Chrome 120
- Metalet 版本：3.4.9
- Node.js：v20.19.1
- 项目版本：1.0.0

### 测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 检测钱包 | ✅ | 正常 |
| 连接钱包 | ✅ | 响应快速 |
| 显示余额 | ✅ | 数据正确 |
| 复制地址 | ✅ | 功能正常 |
| 刷新余额 | ✅ | 正常 |
| 断开连接 | ✅ | 正常 |
| 账户切换监听 | ✅ | 自动更新 |
| 网络切换监听 | ✅ | 指示器正确 |
| 响应式布局 | ✅ | 移动端适配良好 |
| 错误处理 | ✅ | 提示清晰 |

### 性能指标
- 首次加载：1.2s
- 钱包连接：0.8s
- 余额刷新：0.5s

### 问题
无

### 建议
无
```

---

## 🎉 测试通过标准

所有以下项目都应该 ✅：

- [ ] Metalet 钱包检测正常
- [ ] 连接钱包功能正常
- [ ] 余额显示正确
- [ ] 地址复制功能正常
- [ ] 刷新余额功能正常
- [ ] 断开连接功能正常
- [ ] 账户切换自动更新
- [ ] 网络切换自动更新
- [ ] UI 响应式布局正常
- [ ] 错误提示清晰友好

## 📝 报告问题

如果发现问题：

1. **记录详细信息**
   - 浏览器版本
   - Metalet 版本
   - 错误消息
   - 复现步骤

2. **查看控制台**
   - F12 打开开发者工具
   - 查看 Console 错误
   - 截图错误信息

3. **检查配置**
   - 运行：`./check-health.sh`
   - 查看输出

---

## 🔗 相关资源

- **集成指南**: [METALET_INTEGRATION.md](./METALET_INTEGRATION.md)
- **API 文档**: https://github.com/metalet-labs/metalet-extension-next
- **故障排除**: [DEVELOPMENT.md](./DEVELOPMENT.md)

---

**测试愉快！** 🚀

